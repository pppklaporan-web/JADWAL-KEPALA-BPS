<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Input Jadwal Pimpinan</title>
  <link rel="icon" type="image/png" href="bps.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <img src="bps.png" alt="Logo BPS" class="logo">
    <h1>ADMIN INPUT JADWAL PIMPINAN</h1>
  </header>

  <main>
    <section class="form-section">
      <h2>Form Input Jadwal</h2>
      <form id="formKegiatan">
        <label>Hari/Tanggal:</label>
        <input type="date" id="tanggal" required>

        <label>Jam Acara:</label>
        <input type="time" id="jam" required>

        <label>Nama Kegiatan:</label>
        <input type="text" id="kegiatan" placeholder="Masukkan nama kegiatan" required>

        <label>Alamat/Tempat:</label>
        <input type="text" id="tempat" placeholder="Masukkan tempat kegiatan" required>

        <label>Tim:</label>
        <input type="text" id="tim" placeholder="Nama Tim atau Personil" required>

        <label>Keterangan:</label>
        <textarea id="keterangan" placeholder="Tambahkan keterangan..."></textarea>

        <label>Pilih Warna Penanda:</label>
        <select id="warna">
          <option value="biru">Biru</option>
          <option value="merah">Merah</option>
          <option value="kuning">Kuning</option>
          <option value="hijau">Hijau</option>
        </select>

        <button type="submit">Simpan Jadwal</button>
      </form>
    </section>

    <section class="table-section">
      <h2>Daftar Jadwal yang Sudah Diinput</h2>
      <table id="tabelKegiatan">
        <thead>
          <tr>
            <th>Hari/Tanggal</th>
            <th>Jam</th>
            <th>Kegiatan</th>
            <th>Tempat</th>
            <th>Tim</th>
            <th>Keterangan</th>
            <th>Warna</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="daftarKegiatan"></tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>© 2025 BPS Provinsi Sumatera Barat</p>
  </footer>

  <!-- Firebase -->
  <script type="module">
    // --- Firebase Configuration ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, updateDoc, doc } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0Flu6NacmEFNBr3_8gaqfmmzUi8gJ8Es",
      authDomain: "jadwal-pimpinan-8b0ef.firebaseapp.com",
      projectId: "jadwal-pimpinan-8b0ef",
      storageBucket: "jadwal-pimpinan-8b0ef.firebasestorage.app",
      messagingSenderId: "360212048977",
      appId: "1:360212048977:web:1ff5749cd1416ad08f5c70"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "jadwal");

    // --- Simpan Jadwal Baru ---
    document.getElementById("formKegiatan").addEventListener("submit", async (e) => {
      e.preventDefault();
      const tanggal = document.getElementById("tanggal").value;
      const jam = document.getElementById("jam").value;
      const kegiatan = document.getElementById("kegiatan").value;
      const tempat = document.getElementById("tempat").value;
      const tim = document.getElementById("tim").value;
      const keterangan = document.getElementById("keterangan").value;
      const warna = document.getElementById("warna").value;

      await addDoc(colRef, { tanggal, jam, kegiatan, tempat, tim, keterangan, warna });
      alert("✅ Jadwal berhasil disimpan!");
      document.getElementById("formKegiatan").reset();
      tampilkanKegiatan();
    });

    // --- Tampilkan Jadwal ---
    async function tampilkanKegiatan() {
      const daftarKegiatan = document.getElementById("daftarKegiatan");
      daftarKegiatan.innerHTML = "";
      const snapshot = await getDocs(colRef);

      snapshot.forEach((docItem) => {
        const data = docItem.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.tanggal}</td>
          <td>${data.jam}</td>
          <td>${data.kegiatan}</td>
          <td>${data.tempat}</td>
          <td>${data.tim}</td>
          <td>${data.keterangan}</td>
          <td><span class="warna-box ${data.warna}">${data.warna}</span></td>
          <td>
            <button class="editBtn" data-id="${docItem.id}">Edit</button>
            <button class="deleteBtn" data-id="${docItem.id}">Hapus</button>
          </td>
        `;
        daftarKegiatan.appendChild(row);
      });

      // Tombol Hapus
      document.querySelectorAll(".deleteBtn").forEach((btn) => {
        btn.addEventListener("click", async () => {
          if (confirm("Yakin hapus jadwal ini?")) {
            await deleteDoc(doc(db, "jadwal", btn.dataset.id));
            tampilkanKegiatan();
          }
        });
      });

      // Tombol Edit
      document.querySelectorAll(".editBtn").forEach((btn) => {
        btn.addEventListener("click", async () => {
          const id = btn.dataset.id;
          const newKegiatan = prompt("Edit nama kegiatan:");
          if (newKegiatan) {
            await updateDoc(doc(db, "jadwal", id), { kegiatan: newKegiatan });
            tampilkanKegiatan();
          }
        });
      });
    }

    // --- Muat awal ---
    tampilkanKegiatan();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Jadwal Pimpinan</title>
  <link rel="icon" type="image/png" href="bps.png" />
  <link rel="stylesheet" href="style.css" />

  <style>
    /* ==== STRIP WARNA DI KIRI ==== */
    tr.color-merah { border-left: 8px solid #ff4d4d; background: #fff5f5; }
    tr.color-biru { border-left: 8px solid #007bff; background: #f5f8ff; }
    tr.color-kuning { border-left: 8px solid #ffc107; background: #fffbea; }
    tr.color-hijau { border-left: 8px solid #28a745; background: #f3fff3; }

    tr td:first-child { font-weight: 600; color: #222; }
    tr td { padding: 10px; vertical-align: middle; }

    thead th {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ==== TAMPILAN TABEL ==== */
    .table-container table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      border-radius: 10px;
      overflow: hidden;
    }
    tbody tr:nth-child(even) { background-color: #fafafa; }

    /* ==== RUNNING TEXT ==== */
    .running-text {
      background: #007bff;
      color: white;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      white-space: nowrap;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-weight: 500;
      font-size: 1rem;
    }
    .running-text span {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 60s linear infinite; /* lebih pelan */
    }
    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-100%); }
    }

    /* ==== HEADER ==== */
    .header-logos {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
    }
    .header-logos img { height: 60px; }
    .header-title { text-align: center; flex: 1; }
    @media (max-width: 600px) {
      .header-logos { flex-direction: column; }
      .header-title h1 { font-size: 1.2rem; }
      .header-title h2 { font-size: 1rem; }
    }

    /* Responsif */
    @media (max-width: 768px) {
      table { font-size: 0.9rem; }
      tr td { padding: 8px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-logos">
      <img src="bps.png" alt="Logo BPS" class="logo-left" />
      <div class="header-title">
        <h1>AGENDA KEGIATAN PIMPINAN</h1>
        <h2>BPS Provinsi Sumatera Barat</h2>
      </div>
      <img src="se.png" alt="Logo Sensus Ekonomi 2026" class="logo-right" />
    </div>
  </header>

  <!-- üîî RUNNING TEXT DINAMIS -->
  <div class="running-text">
    <span id="textBerjalan">Memuat kegiatan hari ini...</span>
  </div>

  <section class="judul-bulan">
    <h3 id="judulBulan"></h3>
  </section>

  <div class="filter-container">
    <input type="text" id="cariKegiatan" placeholder="üîç Cari kegiatan, tempat, atau tim..." />
    <select id="filterBulan">
      <option value="">Semua Bulan</option>
      <option value="01">Januari</option>
      <option value="02">Februari</option>
      <option value="03">Maret</option>
      <option value="04">April</option>
      <option value="05">Mei</option>
      <option value="06">Juni</option>
      <option value="07">Juli</option>
      <option value="08">Agustus</option>
      <option value="09">September</option>
      <option value="10">Oktober</option>
      <option value="11">November</option>
      <option value="12">Desember</option>
    </select>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Hari/Tanggal</th>
          <th>Jam</th>
          <th>Kegiatan</th>
          <th>Tempat</th>
          <th>Tim</th>
          <th>Keterangan</th>
          <th>Kehadiran</th>
        </tr>
      </thead>
      <tbody id="daftarKegiatan"></tbody>
    </table>
  </div>

  <footer>
    <p>¬© 2025 BPS Provinsi Sumatera Barat</p>
  </footer>

  <!-- üî• FIREBASE -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ‚úÖ Konfigurasi Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB0Flu6NacmEFNBr3_8gaqfmmzUi8gJ8Es",
    authDomain: "jadwal-pimpinan-8b0ef.firebaseapp.com",
    projectId: "jadwal-pimpinan-8b0ef",
    storageBucket: "jadwal-pimpinan-8b0ef.firebasestorage.app",
    messagingSenderId: "360212048977",
    appId: "1:360212048977:web:1ff5749cd1416ad08f5c70",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const colRef = collection(db, "jadwal");

  const daftarKegiatan = document.getElementById("daftarKegiatan");
  const filterBulan = document.getElementById("filterBulan");
  const cariKegiatan = document.getElementById("cariKegiatan");
  const judulBulan = document.getElementById("judulBulan");
  const textBerjalan = document.getElementById("textBerjalan");

  async function tampilkanKegiatan() {
    daftarKegiatan.innerHTML = "<tr><td colspan='7'>‚è≥ Memuat data dari server...</td></tr>";
    const snapshot = await getDocs(colRef);
    daftarKegiatan.innerHTML = "";

    const filterValue = filterBulan.value;
    const cariValue = cariKegiatan.value.toLowerCase();
    const semuaData = [];
    snapshot.forEach(doc => semuaData.push(doc.data()));

    // ‚úÖ Urutkan berdasarkan tanggal & jam
    semuaData.sort((a, b) => {
      const waktuA = new Date(`${a.tanggal} ${a.jam || "00:00"}`);
      const waktuB = new Date(`${b.tanggal} ${b.jam || "00:00"}`);
      return waktuA - waktuB;
    });

    // üîÑ Kumpulkan kegiatan hari ini untuk running text
    const hariIni = new Date().toISOString().split("T")[0];
    let teksJalan = "";

    semuaData.forEach(data => {
      const tanggal = new Date(data.tanggal);
      const tanggalStr = data.tanggal;
      const bulan = String(tanggal.getMonth() + 1).padStart(2, "0");

      // tampilkan di tabel sesuai filter
      if (
        (filterValue === "" || bulan === filterValue) &&
        (cariValue === "" ||
          data.kegiatan.toLowerCase().includes(cariValue) ||
          data.tempat.toLowerCase().includes(cariValue) ||
          data.tim.toLowerCase().includes(cariValue))
      ) {
        const tr = document.createElement("tr");
        tr.classList.add(`color-${data.warna || "putih"}`);
        tr.innerHTML = `
          <td>${tanggal.toLocaleDateString("id-ID", {
            weekday: "long",
            day: "numeric",
            month: "long",
            year: "numeric",
          })}</td>
          <td>${data.jam}</td>
          <td>${data.kegiatan}</td>
          <td>${data.tempat}</td>
          <td>${data.tim}</td>
          <td>${data.keterangan || "-"}</td>
          <td>${data.kehadiran || "-"}</td>
        `;
        daftarKegiatan.appendChild(tr);
      }

      // üîî Running text hanya kegiatan hari ini
      if (tanggalStr === hariIni) {
        teksJalan += ` üïí ${data.jam || ""} - ${data.kegiatan} di ${data.tempat} |`;
      }
    });

    // ‚úÖ Jika kosong
    if (daftarKegiatan.innerHTML.trim() === "") {
      daftarKegiatan.innerHTML = `<tr><td colspan="7">Tidak ada kegiatan ditemukan.</td></tr>`;
    }

    if (teksJalan === "") {
      textBerjalan.textContent = "Tidak ada kegiatan dengan Tim yang sedang berlangsung saat ini.";
    } else {
      textBerjalan.textContent = teksJalan;
    }

    const bulanText = filterBulan.options[filterBulan.selectedIndex].text;
    judulBulan.textContent = filterValue
      ? `Jadwal Bulan ${bulanText}`
      : "Agenda Kegiatan Pimpinan (Semua Bulan)";
  }

  // ‚úÖ Set otomatis bulan saat ini
  window.addEventListener("DOMContentLoaded", () => {
    const bulanSekarang = new Date().getMonth() + 1;
    const bulanStr = String(bulanSekarang).padStart(2, "0");
    filterBulan.value = bulanStr;
    tampilkanKegiatan();
  });

  filterBulan.addEventListener("change", tampilkanKegiatan);
  cariKegiatan.addEventListener("input", tampilkanKegiatan);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agenda Kegiatan Kepala BPS</title>
  <link rel="icon" type="image/png" href="bps.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header-dashboard">
    <img src="bps.png" alt="Logo BPS" class="logo-dashboard" />
    <h1>AGENDA KEGIATAN KEPALA BPS<br>PROVINSI SUMATERA BARAT TAHUN 2025</h1>
    <h3 id="bulanText"></h3>
  </header>

  <section class="filter-section">
    <div class="filter-container">
      <select id="filterBulan">
        <option value="">Semua Bulan</option>
        <option value="0">Januari</option>
        <option value="1">Februari</option>
        <option value="2">Maret</option>
        <option value="3">April</option>
        <option value="4">Mei</option>
        <option value="5">Juni</option>
        <option value="6">Juli</option>
        <option value="7">Agustus</option>
        <option value="8">September</option>
        <option value="9">Oktober</option>
        <option value="10">November</option>
        <option value="11">Desember</option>
      </select>

      <input type="text" id="searchInput" placeholder="Cari nama kegiatan..." />
    </div>
  </section>

  <main class="dashboard">
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Hari/Tanggal</th>
          <th>Jam Acara</th>
          <th>Nama Kegiatan</th>
          <th>Alamat/Tempat</th>
          <th>Tim</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody id="jadwalTabel"></tbody>
    </table>
  </main>

  <footer>
    <p>Â© 2025 BPS Provinsi Sumatera Barat</p>
  </footer>

  <!-- ðŸ”¥ FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0Flu6NacmEFNBr3_8gaqfmmzUi8gJ8Es",
      authDomain: "jadwal-pimpinan-8b0ef.firebaseapp.com",
      projectId: "jadwal-pimpinan-8b0ef",
      storageBucket: "jadwal-pimpinan-8b0ef.firebasestorage.app",
      messagingSenderId: "360212048977",
      appId: "1:360212048977:web:1ff5749cd1416ad08f5c70",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const bulanText = document.getElementById("bulanText");
    const jadwalTabel = document.getElementById("jadwalTabel");
    const filterBulan = document.getElementById("filterBulan");
    const searchInput = document.getElementById("searchInput");

    let semuaData = [];

    function formatBulan(tanggal) {
      const bulan = [
        "Januari","Februari","Maret","April","Mei","Juni",
        "Juli","Agustus","September","Oktober","November","Desember"
      ];
      const d = new Date(tanggal);
      return bulan[d.getMonth()] + " " + d.getFullYear();
    }

    async function ambilData() {
      const colRef = collection(db, "jadwal");
      const snapshot = await getDocs(colRef);
      semuaData = snapshot.docs.map(doc => doc.data());
      tampilkanJadwal(semuaData);
    }

    function tampilkanJadwal(dataArray) {
      jadwalTabel.innerHTML = "";
      let bulanTerakhir = "";

      dataArray.forEach(data => {
        const warnaKelas = data.warna || "biru";
        const row = document.createElement("tr");
        row.classList.add(`baris-${warnaKelas}`);
        row.innerHTML = `
          <td>${data.tanggal}</td>
          <td>${data.jam}</td>
          <td>${data.kegiatan}</td>
          <td>${data.tempat}</td>
          <td>${data.tim}</td>
          <td>${data.keterangan}</td>
        `;
        jadwalTabel.appendChild(row);
        bulanTerakhir = formatBulan(data.tanggal);
      });

      bulanText.textContent = dataArray.length ? ("Bulan: " + bulanTerakhir) : "Tidak ada data untuk filter ini";
    }

    function filterData() {
      const bulanVal = filterBulan.value;
      const keyword = searchInput.value.toLowerCase();

      const hasil = semuaData.filter(item => {
        const tanggal = new Date(item.tanggal);
        const cocokBulan = bulanVal === "" || tanggal.getMonth().toString() === bulanVal;
        const cocokCari = item.kegiatan.toLowerCase().includes(keyword);
        return cocokBulan && cocokCari;
      });

      tampilkanJadwal(hasil);
    }

    filterBulan.addEventListener("change", filterData);
    searchInput.addEventListener("input", filterData);

    ambilData();
  </script>
</body>
</html>

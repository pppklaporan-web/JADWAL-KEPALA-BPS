<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Kegiatan Kepala BPS Sumatera Barat</title>
  <link rel="stylesheet" href="style.css">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB0Flu6NacmEFNBr3_8gaqfmmzUi8gJ8Es",
      authDomain: "jadwal-pimpinan-8b0ef.firebaseapp.com",
      projectId: "jadwal-pimpinan-8b0ef",
      storageBucket: "jadwal-pimpinan-8b0ef.firebasestorage.app",
      messagingSenderId: "360212048977",
      appId: "1:360212048977:web:1ff5749cd1416ad08f5c70"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const jadwalBody = document.getElementById("jadwalBody");
    const cariInput = document.getElementById("cariKegiatan");
    const filterBulan = document.getElementById("filterBulan");

    // Ambil data dari Firestore
    async function tampilkanData() {
      jadwalBody.innerHTML = "<tr><td colspan='6'>Memuat data...</td></tr>";
      const snapshot = await getDocs(collection(db, "jadwalPimpinan"));
      const semuaData = [];
      snapshot.forEach((doc) => semuaData.push(doc.data()));

      renderTabel(semuaData);

      // Event filter pencarian
      cariInput.addEventListener("input", () => {
        const keyword = cariInput.value.toLowerCase();
        const hasil = semuaData.filter(item =>
          item.kegiatan.toLowerCase().includes(keyword) ||
          item.tempat.toLowerCase().includes(keyword) ||
          item.keterangan.toLowerCase().includes(keyword)
        );
        renderTabel(hasil);
      });

      // Filter berdasarkan bulan
      filterBulan.addEventListener("change", () => {
        const bulanDipilih = filterBulan.value;
        const hasil = semuaData.filter(item => {
          const bulan = new Date(item.tanggal).getMonth() + 1;
          return bulanDipilih === "" || bulan === parseInt(bulanDipilih);
        });
        renderTabel(hasil);
      });
    }

    // Render tabel
    function renderTabel(data) {
      if (data.length === 0) {
        jadwalBody.innerHTML = "<tr><td colspan='6'>Tidak ada data</td></tr>";
        return;
      }

      jadwalBody.innerHTML = "";
      data.sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
      data.forEach(item => {
        const tr = document.createElement("tr");
        if (item.warna) tr.classList.add(`color-${item.warna}`);
        tr.innerHTML = `
          <td>${new Date(item.tanggal).toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' })}</td>
          <td>${item.jam}</td>
          <td>${item.kegiatan}</td>
          <td>${item.tempat}</td>
          <td>${item.tim}</td>
          <td>${item.keterangan || '-'}</td>
        `;
        jadwalBody.appendChild(tr);
      });
    }

    // Tampilkan nama bulan di header
    const bulanSekarang = new Date().toLocaleString('id-ID', { month: 'long' });
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('namaBulan').textContent =
        bulanSekarang.charAt(0).toUpperCase() + bulanSekarang.slice(1);
      tampilkanData();
    });
  </script>
</head>

<body>
  <header>
    <div class="header-logos">
      <img src="bps.png" alt="Logo BPS" class="logo-left">
      <img src="SEbps.png" alt="Logo Sensus Ekonomi 2026" class="logo-right">
    </div>
    <div class="header-title">
      <h1>Agenda Kegiatan Kepala BPS</h1>
      <h2>Provinsi Sumatera Barat Tahun 2025</h2>
    </div>
  </header>

  <section class="judul-bulan">
    <h3>Bulan: <span id="namaBulan"></span></h3>
  </section>

  <section class="filter-container">
    <input type="text" id="cariKegiatan" placeholder="Cari kegiatan, tempat, atau keterangan..." />
    <select id="filterBulan">
      <option value="">Semua Bulan</option>
      <option value="1">Januari</option>
      <option value="2">Februari</option>
      <option value="3">Maret</option>
      <option value="4">April</option>
      <option value="5">Mei</option>
      <option value="6">Juni</option>
      <option value="7">Juli</option>
      <option value="8">Agustus</option>
      <option value="9">September</option>
      <option value="10">Oktober</option>
      <option value="11">November</option>
      <option value="12">Desember</option>
    </select>
  </section>

  <div class="table-container">
    <table id="jadwalTable">
      <thead>
        <tr>
          <th>Hari/Tanggal</th>
          <th>Jam Acara</th>
          <th>Nama Kegiatan</th>
          <th>Alamat/Tempat</th>
          <th>Tim</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody id="jadwalBody"></tbody>
    </table>
  </div>
</body>
</html>
